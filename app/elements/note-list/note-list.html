<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/core-icons/core-icons.html">
<link rel="import" href="../../bower_components/core-list/core-list.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-action-dialog.html">
<link rel="import" href="../../bower_components/paper-input/paper-autogrow-textarea.html">
<link rel="import" href="../../bower_components/paper-input/paper-input-decorator.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/core-icons/core-icons.html">
<link rel="import" href="../../bower_components/core-icons/hardware-icons.html">


<style shim-shadowdom>
  html /deep/ [autofocus] {
    color: #03a9f4;
  }

  html /deep/ .colored {
    border: 1px solid #0f9d58;
    background-color: #b7e1cd;
    color: #0f9d58;
  }

  html /deep/ .size-position {
    position: fixed;
    top: 16px;
    right: 16px;
  }
</style>

<polymer-element name="note-list" attributes="">
  <template>
    <link rel="stylesheet" href="note-list.css">
    
      <core-list id="list" data="{{list}}" flex>
        <template>
          <div flex class="row {{ {selected: selected} | tokenList }}">
              <note-card computerTagged="{{ model | hasComputer }}" phoneTagged="{{ model | hasPhone }}"  tabletTagged="{{ model | hasTablet }}" card="{{model}}" selected="{{selected}}"></note-card>
          </div>
        </template>
      </core-list>

    <paper-fab class="add" icon="add" on-click="{{addItem}}"></paper-fab>
    <paper-action-dialog id="addItemDialog" backdrop autoCloseDisabled layered="false">
      <div horizontal layout>
        <paper-input flex id="dialogInputTitle" label="Title"></paper-input>
        <core-icon class="tag" id="dialogTagComputer" on-click="{{tagClicked}}" selected="false" icon="hardware:computer"></core-icon>
        <core-icon class="tag" id="dialogTagPhone" on-click="{{tagClicked}}" selected="false" icon="hardware:phone-android"></core-icon>
        <core-icon class="tag" id="dialogTagTablet" on-click="{{tagClicked}}" selected="false" icon="hardware:tablet"></core-icon>
      </div>
      <paper-input id="dialogInputDescription" label="Description"></paper-input>
      <paper-button dismissive>Cancel</paper-button>
      <paper-button affirmative autofocus on-click="{{commitNote}}">Done</paper-button>
    </paper-action-dialog>
  </template>
  <script>
    (function () {

      function clearDialog() {
        document.getElementById("dialogInputTitle").value = "";
        document.getElementById("dialogInputDescription").value = "";
      }

      function Note(title, description, tags) {
        this.title = title;
        this.description = description;
        this.tags = tags;

        this.hasTag = function(tag) {
          console.log("hasTag = " + this.tags[tag]);

          return this.tags[tag];
        }
      }

      testList = [];
      for(var i = 0; i < 10; i++) {
        var tags = 
        {
          computer : (Math.random() < .5),
          phone : (Math.random() < .5),
          tablet : (Math.random() < .5),
        };
        console.log(i);
        testList.push( new Note(lorem.ipsum("lorem_s1$40"), lorem.ipsum("lorem_s5$400"), tags));
      }

      Polymer({

        hasComputer: function(model) {
          if(model != undefined) {
            return model.tags["computer"];
          }

          return false;
        },
        hasPhone : function(model) {
          if(model != undefined) {
           return model.tags["phone"];
          }

          return false;
        }, 
        hasTablet : function(model) {
          if(model != undefined) {
            return model.tags["tablet"];
          }

          return false;
        },
        tagClicked: function(e, detail, sender) {
          var state = sender.getAttribute("selected");

          //flip!
          if(state == "true") {
            state = "false"
          } else {
            state = "true";
          }

          sender.setAttribute("selected", state);
        },

        commitNote: function(e, detail, sender) {
          titleField = document.getElementById("dialogInputTitle");
          descriptionField = document.getElementById("dialogInputDescription");

          tags = {  computer : document.getElementById("dialogTagComputer").getAttribute("selected"),
          phone :  document.getElementById("dialogTagPhone").getAttribute("selected"),
          tablet : document.getElementById("dialogTagTablet").getAttribute("selected")
        }

          if(titleField.value.length > 0) {
           testList.unshift(new Note(titleField.value, descriptionField.value, tags));
          }
          
          clearDialog();
        },

        addItem: function(e, detail, sender) {
          document.getElementById("addItemDialog").toggle();
          console.log("Clicked something");
        },


        // define element prototype here
        list : testList
      });

    })();
  </script>
</polymer-element>
